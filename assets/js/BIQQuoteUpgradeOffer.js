(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{274:function(e,t,i){},279:function(e,t,i){"use strict";i.r(t);var o=i(20);const s=["standard","executive","vip","chauffeur"],r=["minicab","mpv","minibus","coach"],a={VehicleClass:null,VehicleType:null,image:null,name:null},d={selectedQuoteId:null,selectedVehicleIndex:null,upgradeQuoteId:null,upgradeVehicleIndex:null,priceDifference:9999,selectedVehicle:a,upgradeVehicle:a,title:"No Upgrade",description:"No Upgrade",gaEventData:{category:"Quotes",action:"Quote Upgrade"},bulletPoints:[]},n=(e,t,i)=>{switch(e){case"class":return t.people<=4;case"type":return t.people<=4&&t.people===i.passengers;default:throw`Unknown category upgrade type [${e}]!"`}},c=e=>{let t=e.props;switch(e.categoryType){case"class":t=()=>p(e);break;case"type":t=()=>l(e)}return t},l=e=>({...e.props(),title:"It looks a little tight!",description:"We recommend you upgrade to a bigger vehicle, you might be a bit squashed.",gaEventData:{category:"Quotes",action:"upgrade type to "+e.data.vehicle.type},bulletPoints:["More space for passengers","More storage space for your luggage","Peace of mind, everything will fit!"]}),p=e=>{let t=e.data.vehicle.class;return"vip"===t&&(t="luxury"),{...e.props(),title:"Upgrade To "+t,description:`We recommend you upgrade, For just Â£${e.priceDifference.toFixed(2)} more you can ride in an ${t} vehicle.`,gaEventData:{category:"Quotes",action:"upgrade class to "+t},bulletPoints:["More comfortable and spacious ride.",(i=t,i.charAt(0).toUpperCase()+i.slice(1))+" class driver.","Recommended for business travels and airport transfers."]};var i};const g=e=>({categoryType:e,exists:!1,props:()=>({})}),u=e=>({type:e,upgradeCriteria:n});class h{constructor(e,t,i){this._resetRecommendation=this._resetRecommendation.bind(this),this._setCategories=this._setCategories.bind(this),this._upgradeTierRecommendation=this._upgradeTierRecommendation.bind(this),this._recommendForSelected=this._recommendForSelected.bind(this),this._mapCategoryUpgradesForSelected=this._mapCategoryUpgradesForSelected.bind(this),this._mapQuoteUpgradesForSelected=this._mapQuoteUpgradesForSelected.bind(this),this._commonUpgradeProps=this._commonUpgradeProps.bind(this),this.makeRecommendationFor=this.makeRecommendationFor.bind(this),this.setRecommendedUpgrade=this.setRecommendedUpgrade.bind(this),this.getRecommendedUpgrade=this.getRecommendedUpgrade.bind(this),this.getQuotes=e,this.getJourney=t,this.debugging=i,this.upgradeTiers={class:s,type:r},this.quotes={},this._setCategories(),this._resetRecommendation()}_setCategories(){this.availableCategoryUpgrades=Object.keys(this.upgradeTiers).map(u)}_resetRecommendation(){this.priceDifference=9999,this.upgradeRecommendation={categoryType:null,exists:!1,tierUpgrade:null,data:{key:null,quoteId:null,quote:{},vehicleIndex:null,vehicle:{price:this.priceDifference},priceDifference:this.priceDifference}}}setRecommendedUpgrade(e){this.recommendedUpgrade={...e,props:e.exists?c(e):()=>({}),selectedQuoteId:this.selectedQuoteId,selectedQuote:this.selectedQuote,selectedVehicleIndex:this.selectedVehicleIndex,selectedVehicle:this.selectedVehicle},this.debugging&&console.log("Recommended Upgrade Set",this.recommendedUpgrade)}getRecommendedUpgrade(){return{...this.recommendedUpgrade}}makeRecommendationFor(e,t){this._resetRecommendation(),this.selectedQuote=e,this.selectedVehicle=e.vehicles[t],this.selectedQuoteId=e.quote_id,this.selectedVehicleIndex=t,this.debugging&&(console.group("-- Making upgrade recommendation for selected quote --"),console.log("availableCategoryUpgrades",this.availableCategoryUpgrades),console.log("selectedQuoteId",this.selectedQuoteId),console.log("selectedVehicleIndex",this.selectedVehicleIndex),console.log("selectedQuote",this.selectedQuote),console.log("selectedVehicle",this.selectedVehicle),console.log("priceDifference",this.priceDifference),console.log("upgradeRecommendation",{...this.upgradeRecommendation})),this.setRecommendedUpgrade(this._recommendForSelected()),this.debugging&&(console.log("priceDifference",this.priceDifference),console.log("upgradeRecommendation",{...this.upgradeRecommendation}),console.groupEnd())}_recommendForSelected(){this.quotes=this.getQuotes();const e=this.availableCategoryUpgrades.map(this._mapCategoryUpgradesForSelected).filter(e=>e.exists);return this.debugging&&console.log("upgradeOptions",e),this.quotes={},e.length&&(this.priceDifference=e[0].data.priceDifference,this.upgradeRecommendation=e[0]),{upgradeQuoteId:this.upgradeRecommendation.data.quoteId,upgradeQuote:this.upgradeRecommendation.data.quote,upgradeVehicleIndex:this.upgradeRecommendation.data.vehicleIndex,upgradeVehicle:this.upgradeRecommendation.data.vehicle,priceDifference:this.priceDifference,...this.upgradeRecommendation}}_upgradeTierRecommendation(e,t){if(!this.upgradeTiers.hasOwnProperty(e.type))throw new ErrorEvent("WARNING",{error:new Error("BIQ Recommended Quote Upgrade Tier Error"),message:`No tier found with category value of ${e.type}.`});const i=this.upgradeTiers[e.type].indexOf(this.selectedVehicle.type[e.type]),o=e.upgradeCriteria(e.type,this.getJourney(),this.selectedVehicle);return{currentTier:i,nextTier:i+1,available:i<this.upgradeTiers[e.type].length-1&&o&&t}}_mapCategoryUpgradesForSelected(e){const t=this._upgradeTierRecommendation(e,!0);if(!t.available)return g(e.type);const i=parseInt(t.nextTier,10),o=this.upgradeTiers[e.type][i];this.debugging&&(console.log("upgradeTierRecommendation",t),console.log("tierUpgrade",o),console.group("-- quote upgrade map --"));const s=Object.keys(this.quotes).map(t=>this._mapQuoteUpgradesForSelected(t,e.type,o)).filter(e=>e.active&&e.upgradeVehicles.length);if(this.debugging&&(console.log("quoteUpgrades",s),console.groupEnd()),!s.length)return g(e.type);const r=s.reduce((e,t)=>e.priceDifference<t.priceDifference?e:t,{quoteId:this.selectedQuoteId,priceDifference:this.priceDifference});return this.debugging&&(console.log("cheapestUpgradeQuote",r),console.log("cheapestUpgradeQuote.vehicleIndex",r.vehicleIndex)),void 0===r.vehicleIndex||r.vehicleIndex<0||r.quoteId===this.selectedQuoteId&&r.vehicleIndex===this.selectedVehicleIndex?g(e.type):{categoryType:e.type,exists:!0,tierUpgrade:o,props:this._commonUpgradeProps,data:{key:r.quoteId,quoteId:r.quoteId,vehicleIndex:r.vehicleIndex,quote:this.quotes[r.quoteId],vehicle:this.quotes[r.quoteId].vehicles[r.vehicleIndex],priceDifference:r.priceDifference}}}_mapQuoteUpgradesForSelected(e,t,i){this.debugging&&(console.group("-- _mapQuoteUpgradesForSelected --"),console.log("Potential upgrade quote ID",e),console.log("Upgrade category vehicle type",t),console.log("Upgrade tier",i),console.log("Potential upgrade quote",this.quotes[e]));const o=this.quotes[e],s=o.active;if(!s)return{quoteId:e,active:s};const r=o.vehicles,a=r.filter(e=>e.type[t]===i),d=r.indexOf(a[0]),n=a.length?a[0].price-this.selectedVehicle.price:this.priceDifference;return n<this.priceDifference&&n>0&&(this.priceDifference=this.selectedVehicle.price+n),this.debugging&&a.length&&console.log("Only available upgrade vehicles",a),this.debugging&&(console.log("All vehicles",o.vehicles),console.log("Upgrade Quote Price",this.priceDifference),console.log("Price difference between quotes",n),console.groupEnd()),{active:s,categoryType:t,tierUpgrade:i,quoteId:e,vehicleIndex:d,priceDifference:n,upgradeVehicles:a}}_commonUpgradeProps(){return{selectedQuoteId:this.selectedQuoteId,selectedVehicleIndex:this.selectedVehicleIndex,upgradeQuoteId:this.upgradeRecommendation.data.quoteId,upgradeVehicleIndex:this.upgradeRecommendation.data.vehicleIndex,priceDifference:this.upgradeRecommendation.data.priceDifference,selectedVehicle:{VehicleClass:this.selectedVehicle.class,VehicleType:this.selectedVehicle.type,image:this.selectedVehicle.image,name:this.selectedVehicle.name},upgradeVehicle:{VehicleClass:this.upgradeRecommendation.data.vehicle.class,VehicleType:this.upgradeRecommendation.data.vehicle.type,image:this.upgradeRecommendation.data.vehicle.image,name:this.upgradeRecommendation.data.vehicle.name}}}}i(274);const m={journey:{type:String,required:!0,default:""},quote:{type:String,required:!0,default:""},vehicle:{type:Number,required:!0,default:0},confirmUpgradeActionText:{type:String,default:"Upgrade"},cancelUpgradeActionText:{type:String,default:"Don't Upgrade"},debugging:{type:Boolean,default:!1}},f={name:"unavailable"},y={name:"confirm"},v={name:"cancel"};var U={name:"QuoteUpgradeOfferModal",props:m,computed:{...Object(o.c)(["journeyDetails","journeyQuotes"])},methods:{generateUpgradeOffer:function(){this.quotesRecommendedUpgrade.makeRecommendationFor(this.journeyQuotes[this.quote],this.vehicle);const e=this.quotesRecommendedUpgrade.getRecommendedUpgrade();if(this.debugging&&(console.group("Upgrade Recommendation"),console.log("upgrade",e),console.log("props",e.props()),console.groupEnd()),!e.exists)return this.$emit(f.name,e);this.upgrade_props=e.props(),this.has_upgrade=!0},onCancel:function(e){this.$emit(v.name,e)},onConfirm:function(e){e.data={recommendedUpgrade:this.quotesRecommendedUpgrade.getRecommendedUpgrade()},this.$emit(y.name,e)}},data(){return{quotesRecommendedUpgrade:new h(()=>this.journeyQuotes,()=>this.journeyDetails,this.debugging),has_upgrade:!1,upgrade_props:d}},mounted(){this.generateUpgradeOffer()},updated(){this.$refs.overlay.focus()}},b=i(19),_=Object(b.a)(U,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.has_upgrade?i("transition",{attrs:{name:"modal"}},[i("div",{ref:"overlay",staticClass:"modal-mask",attrs:{tabindex:"0"},on:{keydown:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"esc",27,t.key,["Esc","Escape"])?null:e.onCancel(t)},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onConfirm(t)}]}},[i("div",{staticClass:"modal-wrapper"},[i("div",{staticClass:"modal-container"},[i("div",{staticClass:"modal-header"},[e._t("header",[i("h5",[e._v(e._s(e.upgrade_props.title))])],{text:e.upgrade_props.title})],2),e._v(" "),i("div",{staticClass:"modal-body d-flex flex-wrap"},[e._t("body",[i("p",[e._v(e._s(e.upgrade_props.description))])],{upgrade:e.upgrade_props})],2),e._v(" "),i("div",{staticClass:"modal-footer d-flex flex-wrap justify-content-end"},[e._t("footer",[i("button",{staticClass:"btn btn-secondary",on:{click:e.onCancel}},[e._v(e._s(e.cancelUpgradeActionText))]),e._v(" "),i("button",{staticClass:"btn btn-primary",on:{click:e.onConfirm}},[e._v(e._s(e.confirmUpgradeActionText))])],{cancel:e.onCancel,confirm:e.onConfirm})],2)])])])]):e._e()}),[],!1,null,null,null);t.default=_.exports}}]);
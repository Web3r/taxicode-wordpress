(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{256:function(e,t,i){"use strict";i.d(t,"c",(function(){return s})),i.d(t,"a",(function(){return a}));const s={submit:{name:"submit"},validated:{name:"validated"},validationError:{name:"validationError"}},a={props:{validClass:{type:String,default:""},errorClass:{type:String,default:"is-invalid"},errorState:{type:String,default:null},values:{type:Object,default:function(){return{}}},debugging:{type:Boolean,default:!1}},data:()=>({fields:{}}),methods:{validate:function(){return this.validateValues()},specialValidationErrors:function(){return{}},specialInputValues:function(){return{}},errorStateClass:function(e){return null==this.fields[e].error?"":this.fields[e].error?this.errorClass:this.validClass},setFieldValues:function(){const e=this;this.debugging&&(console.group(`Setting ${this.$options._componentTag} values`),console.log("Fields Before",{...this.fields}),console.log("Values",this.values)),Object.keys(this.values).forEach(t=>{if(!e.fields.hasOwnProperty(t))return void(e.debugging&&console.info(`${e.$options._componentTag} does not contain field '${t}'`));const i=e.fields[t].hasOwnProperty("value")?"value":"selected";e.fields[t][i]=e.values[t]}),this.debugging&&(console.log("Fields After",{...this.fields}),console.groupEnd())},validateValues:function(){const e=this;let t=0;return this.debugging&&console.group(`Validating ${this.$options._componentTag} values`),Object.keys(this.fields).forEach(i=>{if(e.fields[i].error=null,!e.fields[i].required)return;const s=e.fields[i].hasOwnProperty("value")?"value":"selected";""==e.fields[i][s]?(e.fields[i].error=e.fields[i].errorMsg,e.debugging&&console.info(`Invalid field value for '${i}' -- ${e.fields[i].error}`),t++):e.fields[i].error=""}),this.debugging&&console.groupEnd(),0==t},validationErrors:function(){const e=this,t={};return Object.keys(this.fields).forEach(i=>{t[i]=e.fields[i].error}),{...this.specialValidationErrors(),...t}},inputValues:function(){const e=this,t={};return Object.keys(this.fields).forEach(i=>{const s=e.fields[i].hasOwnProperty("value")?"value":"selected";t[i]=e.fields[i][s]}),{...this.specialInputValues(),...t}}}};t.b=a},264:function(e,t,i){"use strict";var s=i(33),a=i.n(s),o=i(21),r=i(256),l=i(15),n=i(36),u=i(255),d=i(254);const c={name:"input"},p={name:"biqPlacesLookupError"};var f={name:"PlacesLookup",components:{"vue-typeahead-bootstrap":d.a},props:{biqPlacesLookup:{type:String,required:!0,default:"//places/?term="},id:{type:String,default:"biq-places-lookup"},placeholder:{type:String,default:"Location postcode or place name"},label:{type:String,default:""},value:{type:String,default:""},required:{type:Boolean,default:!1},size:{type:String,default:null,validator:e=>["lg","sm"].indexOf(e)>-1},containerClass:{type:String,default:""},validClass:{type:String,default:""},errorClass:{type:String,default:"is-invalid"},errorState:{type:String,default:null},debugging:{type:Boolean,default:!1}},data:()=>({locations:[],force_lookup:!0}),updated(){this.force_lookup?this.locationSearch(this.value):this.$refs.locationfield.inputValue=this.value},watch:{location:{handler:u.a.debounce((function(e){this.locationSearch(e)}),500),immediate:!0}},computed:{location:{get(){return this.value},set(e){this.$emit(c.name,e)}},inputID:function(){return this.id+"-input"},errorStateClass:function(){const e=null==this.errorState?"":this.errorState?this.errorClass:this.validClass;return`${this.id} ${e}`}},methods:{locationSearch:function(e){if(null===e||"string"!=typeof e||e.length<3)return;this.debugging&&(console.info(),console.log(`BIQ Places ${this.label} lookup to API '${this.biqPlacesLookup}'`,e)),this.force_lookup=!1,this.$refs.locationfield.inputValue=e;const t=this,i=`${this.biqPlacesLookup}${e}`;let s=[],o=[],r=[];a.a.get(i).then(e=>{if(t.debugging&&console.log(`BIQ Places ${this.label} response`,e),"OK"!=e.data.status)throw new ErrorEvent(e.data.status,{error:new Error(`BIQ Places ${t.label} lookup to API Error`),message:e.data[e.data.status.toLowerCase()]});const i=e.data.results,a=(e,t)=>({string:e,type:t});void 0!==i.STATION&&(o=i.STATION.map(e=>a(e,"station"))),void 0!==i.AIRPORT&&(s=i.AIRPORT.map(e=>a(e,"airport"))),void 0!==i.LOCATION&&(r=i.LOCATION.map(e=>a(e,"location")));const l=i.GOOGLE.map(e=>a(e.string,e.poi?"poi":"general"));t.locations=s.concat(o,r,l)}).catch(e=>{t.locations=[];const s={data:{id:t.id,URL:i,message:e.message||`Unknown BIQ Places ${t.label} lookup to API Error`,error:e}};t.$emit(p.name,s)})},validate:function(){return!(this.required&&(null==this.value||""==this.value))}}},h=i(19);const m={components:{"biq-places-lookup":Object(h.a)(f,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{class:e.containerClass},[e.label?i("label",{attrs:{id:e.inputID,for:e.id}},[e._v(e._s(e.label))]):e._e(),e._v(" "),i("vue-typeahead-bootstrap",{ref:"locationfield",attrs:{id:e.id,placeholder:e.placeholder,size:e.size,inputClass:e.errorStateClass,"show-all-results":!0,"show-on-focus":!0,data:e.locations,serializer:function(e){return e.string}},on:{hit:function(t){e.selectedLocation=t}},scopedSlots:e._u([{key:"suggestion",fn:function(t){var s=t.data,a=t.htmlText;return[i("div",{staticClass:"d-flex align-items-center"},["station"==s.type?i("span",[i("font-awesome-icon",{attrs:{icon:"train"}})],1):"airport"==s.type?i("span",[i("font-awesome-icon",{attrs:{icon:"plane"}})],1):i("span",[i("font-awesome-icon",{attrs:{icon:"map-marker-alt"}})],1),e._v(" "),i("span",{staticClass:"ml-4",domProps:{innerHTML:e._s(a)}})])]}}]),model:{value:e.location,callback:function(t){e.location=t},expression:"location"}},[i("template",{slot:"prepend"}),e._v(" "),e._v(" "),i("template",{slot:"append"})],2)],1)}),[],!1,null,null,null).exports,"biq-process-form-submit":()=>i.e(7).then(i.bind(null,258))},props:{...r.a.props,biqPublicKey:{type:String,required:!0,default:""},biqPlacesLookup:{type:String,required:!0,default:"//places/?term="},biqQuotesFrom:{type:String,required:!0,default:"//booking/quote/"},searchOnLoad:{type:Boolean,default:!1},idPrefix:{type:String,default:"biq"},debugging:{type:Boolean,default:!1},useButtons:{type:Boolean,default:!0}},data(){return{fields:Object(n.c)(this.idPrefix),date:"",time:"",return_date:"",return_time:"",errors:{date:null,time:null,return_date:null,return_time:null},date_picker_formats:{short:{year:"numeric",month:"short",day:"2-digit"},medium:{year:"numeric",month:"short",day:"2-digit",weekday:"short"}}}},mounted(){this.setFieldValues(),this.searchOnLoad&&this.onSearchQuotesFormSubmit()},computed:{...Object(o.c)(["searchDetails","loadingQuotes"]),hasReturn:function(){return this.fields.journey_type.selected===n.a}},methods:{...r.a.methods,...Object(o.b)(["searchingQuotes","apiQuotesError"]),journeyDateTimeErrorState:function(e){return null!==this.errors[e]?!this.errors[e].length:null},onPlacesLookupError:function(e){this.debugging&&(console.group(e.data.message),console.log(e),console.groupEnd())},setFieldValues:function(){const e=this.searchDetails;this.debugging&&console.log("BIQ Search Form from State",e),this.fields.journey_type.selected=e.journey_type,this.fields.pickup.value=e.pickup,this.fields.destination.value=e.destination,e.vias.length&&(this.fields.via.value=e.vias[0]),this.fields.people.value=e.people,this.date=e.date,this.time=e.time,this.hasReturn&&null!==e.returning.date&&(this.return_date=e.returning.date),this.hasReturn&&null!==e.returning.time&&(this.return_time=e.returning.time),this.$nextTick(()=>{this.$refs.pickupfield.inputValue=this.fields.pickup.value,this.$refs.destinationfield.inputValue=this.fields.destination.value,this.$refs.viafield.inputValue=this.fields.via.value})},onSearchQuotesFormSubmit:function(e){e.preventDefault(),this.$emit(r.c.submit.name,e),this.validate()&&this.searchApiQuotes()},validate:function(){this.errors={date:null,time:null,return_date:null,return_time:null};let e=0;this.validateValues()||e++,null!=this.date&&""!=this.date||(this.errors.date="Journey date is invalid",e++),null!=this.time&&""!=this.time||(this.errors.time="Journey time is invalid",e++),this.hasReturn&&(null!=this.return_date&&""!=this.return_date||(this.errors.return_date="Journey return date is invalid",e++),null!=this.return_time&&""!=this.return_time||(this.errors.return_time="Journey return time is invalid",e++));const t=0===e;return this.emitValidationEvent(t),t},emitValidationEvent:function(e){let t=r.c.validated.name;const i={data:{values:{...this.inputValues()}}};e||(t=r.c.validationError.name,i.data.errors={...this.validationErrors(),...this.errors},this.debugging&&(console.group("BIQ Search Form Validation Error"),console.log("Validation Error Fields",{...this.validationErrors()}),console.log("Validation Error",i.data.errors),console.groupEnd())),this.$emit(t,i)},searchApiQuotes:function(){const e=this,t=this.inputValues(),i={journey_type:t.journey_type,pickup:t.pickup,destination:t.destination,people:t.people,date:this.date,time:this.time};let s=null,o=`pickup=${i.pickup}&destination=${i.destination}&date=${i.date} ${i.time}&people=${i.people}`;this.hasReturn?(i.returning={date:this.return_date,time:this.return_time},o=`${o}&return=${i.returning.date} ${i.returning.time}`):i.returning={date:null,time:null};const r=this.fields.via.value;""!=r?(i.vias=[r],o=`${o}&via=${r}`):i.vias=[],this.searchingQuotes(i),this.debugging&&console.group(`Searching BIQ API Quotes from '${this.biqQuotesFrom}'`),a.a.get(`${this.biqQuotesFrom}?key=${this.biqPublicKey}&${o}`).then(t=>{if(e.debugging&&console.log(t),"OK"!=t.data.status)throw new ErrorEvent(t.data.status,{error:new Error("BIQ API Quotes Error"),message:t.data[t.data.status.toLowerCase()]});s=t.data.journey_id;const i={data:{journey_id:s,journey:t.data.journey,quotes:t.data.quotes}};let a=l.f.biqQuotesSearched.name;Object.keys(t.data.quotes).length<=0&&(a=l.f.biqZeroQuotes.name,i.data.error={message:t.data.warnings[0]}),e.$emit(a,i),e.debugging&&(console.info("BIQ API Quotes Searched"),console.groupEnd())}).catch(t=>{const a={data:{quotes:[],journey_id:s,journey:i,error:t}};e.$emit(l.f.biqQuotesError.name,a),e.debugging&&(console.info("BIQ API Quotes Search Error"),console.groupEnd())})}}};t.a=m},279:function(e,t,i){"use strict";i.r(t);var s={name:"ColumnLayout",mixins:[i(264).a]},a=i(19),o=Object(a.a)(s,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("form",{staticClass:"biq-layout biq-layout-column",attrs:{id:"biq-search-form"}},[i("div",{staticClass:"row"},[i("div",{staticClass:"col"},[i("div",{staticClass:"form-group"},[i("label",{attrs:{for:e.fields.journey_type.id,id:e.fields.journey_type.id+"-select"}},[e._v(e._s(e.fields.journey_type.label))]),e._v(" "),i("b-form-select",{staticClass:"biq-journey",attrs:{options:e.fields.journey_type.options,id:e.fields.journey_type.id},model:{value:e.fields.journey_type.selected,callback:function(t){e.$set(e.fields.journey_type,"selected",t)},expression:"fields.journey_type.selected"}})],1)]),e._v(" "),i("div",{staticClass:"col"})]),e._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"col"},[i("biq-places-lookup",{key:"pickup",ref:"pickupfield",attrs:{"biq-places-lookup":e.biqPlacesLookup,required:e.fields.pickup.required,"error-state":e.fields.pickup.error,id:e.fields.pickup.id,label:e.fields.pickup.label,placeholder:e.fields.pickup.placeholder,debugging:e.debugging,"container-class":"form-group"},on:{biqPlacesLookupError:e.onPlacesLookupError},model:{value:e.fields.pickup.value,callback:function(t){e.$set(e.fields.pickup,"value",t)},expression:"fields.pickup.value"}})],1),e._v(" "),i("div",{staticClass:"col"},[i("biq-places-lookup",{key:"destination",ref:"destinationfield",attrs:{"biq-places-lookup":e.biqPlacesLookup,required:e.fields.destination.required,"error-state":e.fields.destination.error,id:e.fields.destination.id,label:e.fields.destination.label,placeholder:e.fields.destination.placeholder,debugging:e.debugging,"container-class":"form-group"},on:{biqPlacesLookupError:e.onPlacesLookupError},model:{value:e.fields.destination.value,callback:function(t){e.$set(e.fields.destination,"value",t)},expression:"fields.destination.value"}})],1)]),e._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"col"},[i("biq-places-lookup",{key:"via",ref:"viafield",attrs:{"biq-places-lookup":e.biqPlacesLookup,required:e.fields.via.required,"error-state":e.fields.via.error,id:e.fields.via.id,label:e.fields.via.label,placeholder:e.fields.via.placeholder,debugging:e.debugging,"container-class":"form-group"},on:{biqPlacesLookupError:e.onPlacesLookupError},model:{value:e.fields.via.value,callback:function(t){e.$set(e.fields.via,"value",t)},expression:"fields.via.value"}})],1),e._v(" "),i("div",{staticClass:"col"},[i("div",{staticClass:"form-group"},[i("label",{attrs:{id:e.fields.people.id+"-input",for:e.fields.people.id}},[e._v(e._s(e.fields.people.label))]),e._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:e.fields.people.value,expression:"fields.people.value"}],staticClass:"biq-people form-control",class:e.errorStateClass("people"),attrs:{id:e.fields.people.id,placeholder:e.fields.people.placeholder,required:e.fields.people.required,type:"number",min:"1",max:"99"},domProps:{value:e.fields.people.value},on:{input:function(t){t.target.composing||e.$set(e.fields.people,"value",t.target.value)}}})])])]),e._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"col"},[i("div",{staticClass:"form-group"},[i("label",[e._v("Date")]),e._v(" "),i("b-form-datepicker",{staticClass:"form-control",attrs:{state:e.journeyDateTimeErrorState("date"),id:"tcplugin-date",locale:"en"},model:{value:e.date,callback:function(t){e.date=t},expression:"date"}})],1)]),e._v(" "),i("div",{staticClass:"col"},[i("div",{staticClass:"form-group"},[i("label",[e._v("Time")]),e._v(" "),i("b-form-timepicker",{attrs:{state:e.journeyDateTimeErrorState("time"),id:"tcplugin-time",locale:"en"},model:{value:e.time,callback:function(t){e.time=t},expression:"time"}})],1)])]),e._v(" "),e.hasReturn?i("div",{staticClass:"row"},[i("div",{staticClass:"col"},[i("div",{staticClass:"form-group"},[i("label",[e._v("Return Date")]),e._v(" "),i("b-form-datepicker",{staticClass:"form-control",attrs:{state:e.journeyDateTimeErrorState("return_date"),id:"tcplugin-return-date",locale:"en"},model:{value:e.return_date,callback:function(t){e.return_date=t},expression:"return_date"}})],1)]),e._v(" "),i("div",{staticClass:"col"},[i("div",{staticClass:"form-group"},[i("label",[e._v("Return Time")]),e._v(" "),i("b-form-timepicker",{attrs:{state:e.journeyDateTimeErrorState("return_time"),id:"tcplugin-return-time",locale:"en"},model:{value:e.return_time,callback:function(t){e.return_time=t},expression:"return_time"}})],1)])]):e._e(),e._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"col"}),e._v(" "),i("div",{staticClass:"col",attrs:{id:"tcplugin-search-submit"}},[i("div",{staticClass:"form-group"},[i("biq-process-form-submit",{attrs:{processing:e.loadingQuotes,"use-buttons":e.useButtons,"style-class":"submit-btn",label:"Search"},on:{click:e.onSearchQuotesFormSubmit}})],1)])])])}),[],!1,null,null,null);t.default=o.exports}},0,[7]]);
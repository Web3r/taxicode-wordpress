(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{12:function(t,e,n){"use strict";n.d(e,"b",(function(){return a})),n.d(e,"c",(function(){return r})),n.d(e,"a",(function(){return p})),n.d(e,"g",(function(){return c})),n.d(e,"d",(function(){return d})),n.d(e,"e",(function(){return u})),n.d(e,"f",(function(){return g}));var s=n(16),o=n.n(s);class i extends Error{constructor(t,e,n,s){super(s),Error.captureStackTrace(this,i),this.getURL=this.getURL.bind(this),this.getKey=this.getKey.bind(this),this.getCulprit=this.getCulprit.bind(this),this.getDesc=this.getDesc.bind(this),this.setDesc=this.setDesc.bind(this),this.toString=this.toString.bind(this),this.toJSON=this.toJSON.bind(this),this.name="BIQAPIERR",this.data={},this.URL=t,this.k=e,this.e=n,this.setDesc(`${this.name} - ${this.message}`)}hasData(){return Object.keys(this.data).length>0}getData(){return this.data}addData(t){const e={...this.data,...t};this.data=e}getURL(){return this.URL}getKey(){return this.k}getCulprit(){return this.e}getDesc(){return this.desc}setDesc(t){this.desc=t}toString(){return this.getDesc()}toJSON(){return{name:this.name,message:this.message,desc:this.getDesc(),error:this.getCulprit(),stack:this.stack,URL:this.getURL(),key:this.getKey(),data:this.getData()}}}const a="https://api.taxicode.com/",r="https://api.stagingtaxis.co.uk/",p="auth/",c=(t,e,n,s)=>{s&&(console.log(n,{...e}),console.info(e.toString(),e.toJSON()),console.error(e));const o=e.message||"Unknown";return e.setDesc(`${n} - ${o}`),t(e)},d=(t,e,n)=>new Promise((s,a)=>o.a.get(`${t}&key=${e}`).then(o=>s(u(t,e,o,n))).catch(s=>{n&&(console.log("BIQ API Error",{...s}),console.error(s));const o=s.message||"Unknown";return a(new i(t,e,s,o))})),u=(t,e,n,s)=>{if(s&&console.log("BIQ API response for - "+t,n),"OK"!=n.data.status){const t=n.data[n.data.status]||n.data[n.data.status.toLowerCase()];throw console.warn(t),new ErrorEvent(n.data.status,{error:new Error("BIQ API Error"),message:t})}return{...n.data}},g=(t,e,n,s)=>{const o=s||n.message,a=new i(t,e,n,s);return{message:n.message,err:a,data:{URL:t,key:e,message:o,error:n}}}},17:function(t,e,n){"use strict";n.d(e,"a",(function(){return a})),n.d(e,"c",(function(){return r})),n.d(e,"f",(function(){return p})),n.d(e,"e",(function(){return c})),n.d(e,"b",(function(){return d}));var s=n(12),o=n(21),i=n(28);const a={base:{fontFamily:"'Muli', sans-serif",fontSize:"14px",color:"#333"},invalid:{color:"red"}},r=(t,e)=>{if(e){console.log("stripe_cardform_style",t.stripe_cardform_style),console.info("type",typeof t.stripe_cardform_style);try{console.log("parse attempt",JSON.parse(t.stripe_cardform_style))}catch(t){console.error(t)}}return{biq_pk:t.taxicode_public,biq_api_host:t.biq_api_host,paypal_pk:t.paypal_public,stripe_pk:t.stripe_public,stripe_cardform_style:t.stripe_cardform_style,booking_test_mode:"1"==t.test_mode,quote_type:t.quote_type,recommend_upgrade:"1"==t.recommend_upgrade,complete_page_text:t.complete_page_text}},p=t=>({headers:{"X-WP-Nonce":t}}),c=function(t,e){this.appDebugEnabled&&(console.group("Updating BIQ App Settings"),console.log("BIQ App Settings",{...this.settings}),console.log("New BIQ Settings",t));const n="function"==typeof e?e.call(this,t):r(t,this.appDebugEnabled);this.settings=n,this.appDebugEnabled&&(console.info("Updated Settings"),console.log("Settings",n),console.log("BIQ App Settings",{...this.settings}),console.groupEnd())},d={LIVE_API_HOST:s.b,TEST_API_HOST:s.c,AUTH_URI:s.a,PLACES_URI:o.b,QUOTE_URI:o.c,JOURNEY_URI:o.a,CLIENT_SECRET_URI:i.a,PAYMENT_URI:i.b,PGH_CONF:{hidePostalCode:!0}};e.d=d},21:function(t,e,n){"use strict";n.d(e,"b",(function(){return o})),n.d(e,"c",(function(){return i})),n.d(e,"a",(function(){return a})),n.d(e,"d",(function(){return r})),n.d(e,"e",(function(){return p}));var s=n(12);const o="places/?term=",i="booking/quote/",a="booking/journey/?id=",r=(t,e,n,o,i)=>new Promise((a,r)=>{Object(s.d)(`${t}${n}`,e,i).then(t=>t.results).then(t=>{let e=[],n=[],s=[];void 0!==t.AIRPORT&&(e=t.AIRPORT.map(t=>o(t,"airport"))),void 0!==t.STATION&&(n=t.STATION.map(t=>o(t,"station"))),void 0!==t.LOCATION&&(s=t.LOCATION.map(t=>o(t,"location")));const i=t.GOOGLE.map(t=>o(t.string,t.poi?"poi":"general"));return a(e.concat(n,s,i))}).catch(t=>Object(s.g)(r,t,"BIQ Places Lookup API Error",i))}),p=(t,e,n,o)=>{let i=`pickup=${n.pickup}&destination=${n.destination}&date=${n.date} ${n.time}&people=${n.people}`;return n.hasReturn&&(i=`${i}&return=${n.returning.date} ${n.returning.time}`),n.vias.length&&(i=`${i}&via=${n.vias[0]}`),new Promise((n,a)=>{Object(s.d)(`${t}?${i}`,e,o).then(t=>{const e={journey_id:t.journey_id,journey:t.journey,quotes:t.quotes,count:Object.keys(t.quotes).length};return e.count||(e.warnings=t.warnings),n(e)}).catch(t=>Object(s.g)(a,t,"BIQ Quotes Search API Error",o))})}},265:function(t,e,n){"use strict";n.r(e);var s=n(14);var o=function(t){var e=jQuery;let n=e("#toplevel_page_"+t),s=window.location.href,o=s.substr(s.indexOf("admin.php"));n.on("click","a",(function(){var t=e(this);e("ul.wp-submenu li",n).removeClass("current"),t.hasClass("wp-has-submenu")?e("li.wp-first-item",n).addClass("current"):t.parents("li").addClass("current")})),e("ul.wp-submenu a",n).each((function(t,n){e(n).attr("href")!==o||e(n).parent().addClass("current")}))},i=n(29),a=n(17);var r={name:"BIQAdminApp",version:"1.0.1",props:{adminNonce:{type:String,default:""}},computed:{appConfig:function(){return{biq:a.b,BOOKING_DETALS_URI:"booking-details/?booking_ref="}}},methods:{appSettingsUpdated:a.e,getAdminSettings:function(){this.getAppSettings(()=>Object(a.f)(this.adminNonce),t=>({...Object(a.c)(t,this.appDebugEnabled),biq_sk:t.taxicode_private,search_target_permalink:t.search_target_permalink,custom_css:t.custom_css}))}},mixins:[i.a],data(){return{...i.a.data.call(this),settings:{biq_api_host:a.b.LIVE_API_HOST,biq_pk:"",paypal_pk:"",stripe_pk:"",stripe_cardform_style:a.a,booking_test_mode:!1,quote_type:"",recommend_upgrade:!1,complete_page_text:"",biq_sk:"",search_target_permalink:"/booking-instant-quotes/",custom_css:""},app_title:"Booking Instant Quotes Admin v1.0.1",admin_nonce:this.adminNonce}},created(){this.getAdminSettings()}},p=n(22),c=Object(p.a)(r,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"biq-admin-vue-app"}},[n("h1",[t._v(t._s(t.app_title))]),t._v(" "),t.initialised?n("router-view",{attrs:{"admin-nonce":t.admin_nonce,"app-config":t.appConfig,"app-settings":t.appSettings,appRESTBaseURL:t.appURL,debugging:t.appDebugEnabled},on:{appSettingsUpdated:t.appSettingsUpdated}}):t._e()],1)}),[],!1,null,null,null).exports,d=n(46);s.default.use(d.a);var u=new d.a({routes:[{path:"/",name:"SettingsPage",component:()=>n.e(2).then(n.bind(null,277))}]});s.default.config.productionTip=!1,s.default.config.devtools=!1,o("taxicode-app"),window.axios=n(16),window.axios.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",new s.default({render:t=>t(c,{props:{adminNonce:admin_nonce,appURL:biqAppURL,appDebugEnabled:biqAppDebugEnabled}}),el:"#biq-admin-vue-app",router:u})},28:function(t,e,n){"use strict";n.d(e,"a",(function(){return a})),n.d(e,"b",(function(){return r})),n.d(e,"c",(function(){return c})),n.d(e,"d",(function(){return d}));var s=n(12),o=n(16),i=n.n(o);const a="booking/client_gateway_secret/",r="booking/pay/",p={headers:{"Content-Type":"application/application/x-www-form-urlencoded"}},c=(t,e,n,o,a,r)=>(r&&console.group("Getting client secret from "+t),new Promise((c,d)=>{const u=new FormData;u.append("handler",n),u.append("key",e),u.append("quote",o),u.append("vehicle",a),i.a.post(t,u,p).then(n=>Object(s.e)(t,e,n,r)).then(t=>c(t.response.intent.client_secret)).catch(i=>{console.log("Error",i);let r=i.message||"Unknown";i.response?r=i.response:i.request&&(r=i.request);const p=Object(s.f)(t,e,i,`The error message received was: '${r}'`);p.data={...p.data,message:r,type:"payment",handler:n,quote:o,vehicle:a,formData:u},d(p)})})),d=(t,e,n,o)=>(n.append("key",e),new Promise((a,r)=>{i.a.post(t,n,p).then(n=>Object(s.e)(t,e,n,o)).then(t=>a(t)).catch(o=>{const i=o.message||"Unknown",a=Object(s.f)(t,e,o,"BIQ API Booking Error - "+i);a.data.type="booking",a.data.booking={token:n.get("token"),method:n.get("method"),formData:n},r(a)})}))},29:function(t,e,n){"use strict";var s=n(16),o=n.n(s);const i={props:{appURL:{type:String,required:!0,default:"//"},appDebugEnabled:{type:Boolean,default:!1}},computed:{appSettings:function(){return{...this.settings}}},methods:{getAppSettings:function(t,e){const n=this,s=this.appURL+"settings/";this.appDebugEnabled&&console.group(`Loading App Settings from '${s}'`);const i="function"==typeof t?t.call(this):{};o.a.get(s,i).then(t=>{n.appSettingsUpdated(t.data,e),n.initialised=!0}).catch(t=>{n.appDebugEnabled&&(console.info("Updated Settings Error"),console.log(t)),console.error(t)}).finally(()=>{n.appDebugEnabled&&console.groupEnd()})},appSettingsUpdated:function(t,e){this.appDebugEnabled&&(console.group("Updating App Settings"),console.log("App Settings",{...this.settings}),console.log("New Settings",t));const n="function"==typeof e?e.call(this,t):{...t};this.settings=n,this.appDebugEnabled&&(console.info("Updated Settings"),console.log("Settings",n),console.log("App Settings",{...this.settings}),console.groupEnd())}},data:()=>({initialised:!1,settings:{}})};e.a=i}},[[265,1,0]]]);
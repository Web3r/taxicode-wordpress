(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{12:function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return s})),n.d(t,"d",(function(){return i})),n.d(t,"e",(function(){return r}));const o="https://api.taxicode.com/",a="https://api.stagingtaxis.co.uk/",s="auth/",i=(e,t,n,o)=>{if(o&&console.log("BIQ API response for - "+e,n),"OK"!=n.data.status){const e=n.data[n.data.status]||n.data[n.data.status.toLowerCase()];throw console.warn(e),new ErrorEvent(n.data.status,{error:new Error("BIQ API Error"),message:e})}return n.data},r=(e,t,n,o)=>({data:{URL:e,key:t,message:o||n.message,error:n}})},17:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"c",(function(){return r})),n.d(t,"f",(function(){return p})),n.d(t,"e",(function(){return c})),n.d(t,"b",(function(){return d}));var o=n(12),a=n(21),s=n(28);const i={base:{fontFamily:"'Muli', sans-serif",fontSize:"14px",color:"#333"},invalid:{color:"red"}},r=(e,t)=>{if(t){console.log("stripe_cardform_style",e.stripe_cardform_style),console.info("type",typeof e.stripe_cardform_style);try{console.log("parse attempt",JSON.parse(e.stripe_cardform_style))}catch(e){console.error(e)}}return{biq_pk:e.taxicode_public,biq_api_host:e.biq_api_host,paypal_pk:e.paypal_public,stripe_pk:e.stripe_public,stripe_cardform_style:e.stripe_cardform_style,booking_test_mode:"1"==e.test_mode,quote_type:e.quote_type,recommend_upgrade:"1"==e.recommend_upgrade,complete_page_text:e.complete_page_text}},p=e=>({headers:{"X-WP-Nonce":e}}),c=function(e,t){this.appDebugEnabled&&(console.group("Updating BIQ App Settings"),console.log("BIQ App Settings",{...this.settings}),console.log("New BIQ Settings",e));const n="function"==typeof t?t.call(this,e):r(e,this.appDebugEnabled);this.settings=n,this.appDebugEnabled&&(console.info("Updated Settings"),console.log("Settings",n),console.log("BIQ App Settings",{...this.settings}),console.groupEnd())},d={LIVE_API_HOST:o.b,TEST_API_HOST:o.c,AUTH_URI:o.a,PLACES_URI:a.b,QUOTE_URI:a.c,JOURNEY_URI:a.a,CLIENT_SECRET_URI:s.a,PAYMENT_URI:s.b,PGH_CONF:{hidePostalCode:!0}};t.d=d},21:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return p})),n.d(t,"d",(function(){return c})),n.d(t,"e",(function(){return d}));var o=n(12),a=n(16),s=n.n(a);const i="places/?term=",r="booking/quote/",p="booking/journey/?id=",c=(e,t,n,a,i)=>new Promise((r,p)=>{s.a.get(`${e}${n}&key=${t}`).then(n=>Object(o.d)(e,t,n,i)).then(e=>e.results).then(e=>{let t=[],n=[],o=[];void 0!==e.AIRPORT&&(t=e.AIRPORT.map(e=>a(e,"airport"))),void 0!==e.STATION&&(n=e.STATION.map(e=>a(e,"station"))),void 0!==e.LOCATION&&(o=e.LOCATION.map(e=>a(e,"location")));const s=e.GOOGLE.map(e=>a(e.string,e.poi?"poi":"general"));r(t.concat(n,o,s))}).catch(n=>{const a=n.message||"Unknown";p(Object(o.e)(e,t,n,"BIQ Places lookup API Error - "+a))})}),d=(e,t,n,a)=>{let i=`pickup=${n.pickup}&destination=${n.destination}&date=${n.date} ${n.time}&people=${n.people}`;return n.hasReturn&&(i=`${i}&return=${n.returning.date} ${n.returning.time}`),n.vias.length&&(i=`${i}&via=${n.vias[0]}`),new Promise((n,r)=>{s.a.get(`${e}?key=${t}&${i}`).then(n=>Object(o.d)(e,t,n,a)).then(e=>{const t={journey_id:e.journey_id,journey:e.journey,quotes:e.quotes,count:Object.keys(e.quotes).length};t.count||(t.warnings=e.warnings),n(t)}).catch(n=>{const a=n.message||"Unknown";r(Object(o.e)(e,t,n,"BIQ Quotes Search API Error - "+a))})})}},265:function(e,t,n){"use strict";n.r(t);var o=n(14);var a=function(e){var t=jQuery;let n=t("#toplevel_page_"+e),o=window.location.href,a=o.substr(o.indexOf("admin.php"));n.on("click","a",(function(){var e=t(this);t("ul.wp-submenu li",n).removeClass("current"),e.hasClass("wp-has-submenu")?t("li.wp-first-item",n).addClass("current"):e.parents("li").addClass("current")})),t("ul.wp-submenu a",n).each((function(e,n){t(n).attr("href")!==a||t(n).parent().addClass("current")}))},s=n(29),i=n(17);var r={name:"BIQAdminApp",version:"1.0.1",props:{adminNonce:{type:String,default:""}},computed:{appConfig:function(){return{biq:i.b,BOOKING_DETALS_URI:"booking-details/?booking_ref="}}},methods:{appSettingsUpdated:i.e,getAdminSettings:function(){this.getAppSettings(()=>Object(i.f)(this.adminNonce),e=>({...Object(i.c)(e,this.appDebugEnabled),biq_sk:e.taxicode_private,search_target_permalink:e.search_target_permalink,custom_css:e.custom_css}))}},mixins:[s.a],data(){return{...s.a.data.call(this),settings:{biq_api_host:i.b.LIVE_API_HOST,biq_pk:"",paypal_pk:"",stripe_pk:"",stripe_cardform_style:i.a,booking_test_mode:!1,quote_type:"",recommend_upgrade:!1,complete_page_text:"",biq_sk:"",search_target_permalink:"/booking-instant-quotes/",custom_css:""},app_title:"Booking Instant Quotes Admin v1.0.1",admin_nonce:this.adminNonce}},created(){this.getAdminSettings()}},p=n(22),c=Object(p.a)(r,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"biq-admin-vue-app"}},[n("h1",[e._v(e._s(e.app_title))]),e._v(" "),e.initialised?n("router-view",{attrs:{"admin-nonce":e.admin_nonce,"app-config":e.appConfig,"app-settings":e.appSettings,appRESTBaseURL:e.appURL,debugging:e.appDebugEnabled},on:{appSettingsUpdated:e.appSettingsUpdated}}):e._e()],1)}),[],!1,null,null,null).exports,d=n(46);o.default.use(d.a);var u=new d.a({routes:[{path:"/",name:"SettingsPage",component:()=>n.e(2).then(n.bind(null,277))}]});o.default.config.productionTip=!1,o.default.config.devtools=!1,a("taxicode-app"),window.axios=n(16),window.axios.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",new o.default({render:e=>e(c,{props:{adminNonce:admin_nonce,appURL:biqAppURL,appDebugEnabled:biqAppDebugEnabled}}),el:"#biq-admin-vue-app",router:u})},28:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return c})),n.d(t,"d",(function(){return d}));var o=n(12),a=n(16),s=n.n(a);const i="booking/client_gateway_secret/",r="booking/pay/",p={headers:{"Content-Type":"application/application/x-www-form-urlencoded"}},c=(e,t,n,a,i,r)=>(r&&console.group("Getting client secret from "+e),new Promise((c,d)=>{const u=new FormData;u.append("handler",n),u.append("key",t),u.append("quote",a),u.append("vehicle",i),s.a.post(e,u,p).then(n=>Object(o.d)(e,t,n,r)).then(e=>c(e.response.intent.client_secret)).catch(s=>{console.log("Error",s);let r=s.message||"Unknown";s.response?r=s.response:s.request&&(r=s.request);const p=Object(o.e)(e,t,s,`The error message received was: '${r}'`);p.data={...p.data,message:r,type:"payment",handler:n,quote:a,vehicle:i,formData:u},d(p)})})),d=(e,t,n,a)=>(n.append("key",t),new Promise((i,r)=>{s.a.post(e,n,p).then(n=>Object(o.d)(e,t,n,a)).then(e=>i(e)).catch(a=>{const s=a.message||"Unknown",i=Object(o.e)(e,t,a,"BIQ API Booking Error - "+s);i.data.type="booking",i.data.booking={token:n.get("token"),method:n.get("method"),formData:n},r(i)})}))},29:function(e,t,n){"use strict";var o=n(16),a=n.n(o);const s={props:{appURL:{type:String,required:!0,default:"//"},appDebugEnabled:{type:Boolean,default:!1}},computed:{appSettings:function(){return{...this.settings}}},methods:{getAppSettings:function(e,t){const n=this,o=this.appURL+"settings/";this.appDebugEnabled&&console.group(`Loading App Settings from '${o}'`);const s="function"==typeof e?e.call(this):{};a.a.get(o,s).then(e=>{n.appSettingsUpdated(e.data,t),n.initialised=!0}).catch(e=>{n.appDebugEnabled&&(console.info("Updated Settings Error"),console.log(e)),console.error(e)}).finally(()=>{n.appDebugEnabled&&console.groupEnd()})},appSettingsUpdated:function(e,t){this.appDebugEnabled&&(console.group("Updating App Settings"),console.log("App Settings",{...this.settings}),console.log("New Settings",e));const n="function"==typeof t?t.call(this,e):{...e};this.settings=n,this.appDebugEnabled&&(console.info("Updated Settings"),console.log("Settings",n),console.log("App Settings",{...this.settings}),console.groupEnd())}},data:()=>({initialised:!1,settings:{}})};t.a=s}},[[265,1,0]]]);
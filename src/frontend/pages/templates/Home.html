<div>
    <form id="searchform">
        <div class="row">
            <div class="col-6" id="tcplugin-journey-type">
                <div class="form-group">
                    <label>Journey type</label>
                    <b-form-select v-model="journey_type" :options="journey_options"></b-form-select>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col">
                <div class="form-group" id="tcplugin-pickup">
                    <label>Pickup</label>
                    <vue-bootstrap-typeahead
                            v-model="pickup"
                            :inputClass="errors.pickup? 'is-invalid' : ''"
                            :data="pickuplocations"
                            :serializer="item => item.string"
                            @hit="selectedLocation = $event"
                            placeholder="Pickup postcode or place name"
                            ref="pickupfield"
                    >
                        <template slot="suggestion" slot-scope="{ data, htmlText }">
                            <div class="d-flex align-items-center">
                                <span v-if="data.type=='station'"><font-awesome-icon icon="train" /></span>
                                <span v-else-if="data.type=='airport'"><font-awesome-icon icon="plane" /></span>
                                <span v-else><font-awesome-icon icon="map-marker-alt" /></span>
                                <span class="ml-4" v-html="htmlText"></span>
                            </div>
                        </template>
                    </vue-bootstrap-typeahead>
                </div>
            </div>
            <div class="col">
                <div class="form-group" id="tcplugin-destination">
                    <label>Destination</label>
                    <vue-bootstrap-typeahead
                            ref="destinationfield"
                            v-model="destination"
                            :inputClass="errors.destination? 'is-invalid' : ''"
                            :data="destinationlocations"
                            :serializer="item => item.string"
                            @hit="selectedLocation = $event"
                            placeholder="Destination postcode or place name"
                    >
                        <template slot="suggestion" slot-scope="{ data, htmlText }">
                            <div class="d-flex align-items-center">
                                <span v-if="data.type=='station'"><font-awesome-icon icon="train" /></span>
                                <span v-else-if="data.type=='airport'"><font-awesome-icon icon="plane" /></span>
                                <span v-else><font-awesome-icon icon="map-marker-alt" /></span>
                                <span class="ml-4" v-html="htmlText"></span>
                            </div>
                        </template>
                    </vue-bootstrap-typeahead>
                </div>
            </div>

        </div>
        <div class="row">
            <div class="col" id="tcplugin-via">
                <label>(Optional) Via</label>
                <vue-bootstrap-typeahead
                        ref="viafield"
                        v-model="via"
                        :inputClass="errors.via? 'is-invalid' : ''"
                        :data="vialocations"
                        :serializer="item => item.string"
                        @hit="selectedLocation = $event"
                        placeholder="Via postcode or place name"
                >
                    <template slot="suggestion" slot-scope="{ data, htmlText }">
                        <div class="d-flex align-items-center">
                            <span v-if="data.type=='station'"><font-awesome-icon icon="train" /></span>
                            <span v-else-if="data.type=='airport'"><font-awesome-icon icon="plane" /></span>
                            <span v-else><font-awesome-icon icon="map-marker-alt" /></span>
                            <span class="ml-4" v-html="htmlText"></span>
                        </div>
                    </template>
                </vue-bootstrap-typeahead>
            </div>
            <div class="col" id="tcplugin-people">
                <div class="form-group">
                    <label>Number of People</label>
                    <input type="number" class="form-control" :class=" errors.people ? 'is-invalid' : ''" placeholder="People" v-model="people">
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col">
                <div class="form-group" id="tcplugin-date">
                    <label>Date</label>
                    <b-form-datepicker locale="en" class="form-control" :state="errors.date"  v-model="date"></b-form-datepicker>
                </div>
            </div>
            <div class="col">
                <div class="form-group" id="tcplugin-time">
                    <label>Time</label>
                    <b-form-timepicker locale="en" v-model="time" :state="errors.time"></b-form-timepicker>
                </div>
            </div>
        </div>
        <div class="row" v-if="journey_type=='Return'">
            <div class="col" id="tcplugin-return-date">
                <div class="form-group">
                    <label>Return Date</label>
                    <b-form-datepicker locale="en" class="form-control" :state="errors.return_date"  v-model="return_date"></b-form-datepicker>
                </div>
            </div>
            <div class="col">
                <div class="form-group" id="tcplugin-return-time">
                    <label>Return Time</label>
                    <b-form-timepicker locale="en" v-model="return_time" :state="errors.return_time"></b-form-timepicker>
                </div>
            </div>

        </div>
        <div class="row">
            <div class="col">

            </div>
            <div class="col" id="tcplugin-search-submit">
                <div class="form-group">
                    <label></label>
                    <input type="button" class="form-control" value="Search" @click="submitForm">
                </div>
            </div>
        </div>
    </form>
    
    <div id="results">
        
        <div v-if="loadingQuotes">
            Loading...
        </div>
        
        <div v-if="zeroQuotes">
            Sorry, we could not find any quotes for the selected journey.  Please try a different journey.
        </div>

        <div v-if="quote_type!='type_class'" class="row">
            <div v-for="(quote, id) in displayQuotes" class="col-sm-auto">
                
                <div v-if="quote_type=='best'">
                    <div v-if="quote.highlight" class="card" style="width: 18rem;">
                        <img :ref="id" :src="quote.vehicles[0].image" class="card-img-top" alt="Vehicle type image">
                        <div class="card-header">
                            {{quote.highlight}}
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">{{quote.company_name}}</h5>
                            <p :ref="id" id="selected_price" class="card-text text-center display-4">&pound;{{quote.vehicles[0].price}}.00</p>
                            <select @change="flipImage(id, $event)" class="custom-select">
                                <option
                                    v-for="(vehicle, id) in quote.vehicles"
                                    v-model="quote.selected_vehicle"
                                    :value="id"
                                    :data-image="vehicle.image"
                                    :data-price="vehicle.price"
                                >{{vehicle.name}}</option>
                            </select>
                            <router-link 
                                :ref="id" 
                                :to="{ name: 'Checkout', params: { journey: journeyID, quote: id, vehicle: vehicles[0].index } }" 
                                @click.native="setPriceBeforeTransition(id,$event)"
                                :data-price="quote.vehicles[0].price" 
                                class="btn btn-primary btn-block" 
                            >Book Now</router-link>
                        </div>
                    </div>
                </div>
                
                <div v-else class="card" style="width: 18rem;">
                    <img :ref="id" :src="quote.vehicles[0].image" class="card-img-top" alt="Vehicle type image">
                    <div class="card-body">
                        <h5 class="card-title">{{quote.company_name}}</h5>
                        <p :ref="id" id="selected_price" class="card-text text-center display-4">&pound;{{quote.vehicles[0].price}}.00</p>
                        <select @change="flipImage(id,$event)" class="custom-select">
                            <option
                                v-for="(vehicle, id) in quote.vehicles"
                                v-model="quote.selected_vehicle"
                                :value="id"
                                :data-image="vehicle.image"
                                :data-price="vehicle.price"
                            >{{vehicle.name}}</option>
                        </select>
                        <router-link 
                            :ref="id" 
                            :to="{ name: 'Checkout', params: { journey: journeyID, quote: id, vehicle: vehicles[0].index } }" 
                            @click.native="setPriceBeforeTransition(id,$event)"
                            :data-price="quote.vehicles[0].price" 
                            class="btn btn-primary btn-block" 
                        >Book Now</router-link>
                    </div>
                </div>
            </div>
        </div>
        
        <div v-else class="row">
            <div v-for="(quote, type) in displayQuotes" class="col-sm-auto">
                <div class="card" style="width: 18rem;">
                    <img :ref="quote.quote_id" :src="quote.vehicle.image" class="card-img-top" alt="Vehicle type image">
                    <div class="card-header">
                        {{type_map[type]}}
                    </div>
                    <div class="card-body">
                        <h6 class="card-subtitle mb-2 text-muted">{{quote.vehicle.name}}</h6>
                        <div class="card-text d-flex justify-content-center align-items-center">
                            <div class="badge badge-pill badge-secondary"><font-awesome-icon icon="users" /> {{quote.vehicle.passengers}}</div>
                            <div>&nbsp;</div>
                            <div class="badge badge-pill badge-secondary"><font-awesome-icon icon="suitcase" /> {{quote.vehicle.luggage_small}}</div>
                        </div>
                        <p :ref="quote.quote_id" id="selected_price" class="card-text text-center display-4">&pound;{{quote.price}}.00</p>
                        <router-link 
                            :ref="quote.quote_id" 
                            :to="{ name: 'Checkout', params: { journey: journeyID, quote: quote.quote_id, vehicle: quote.vehicle.index } }" 
                            @click.native="onBookNowClicked({ quote: quote.quote_id, vehicle: quote.vehicle.index }, $event)"
                            :data-quote="quote.quote_id" 
                            :data-vehicle="quote.vehicle.index" 
                            class="btn btn-primary btn-block" 
                        >Book Now</router-link>
                    </div>
                </div>
            </div>
            <!--the type_class structure and markup are unavoidably quite different -->
        </div>
    </div>
</div>
